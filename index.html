<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>页面。。</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="common.css">
    <script src="http://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
</head>

<body>
    <select class="input" multiple size="100">
        <optgroup label="Attention Seekers">
            <option value="bounce">bounce</option>
            <option value="flash">flash</option>
            <option value="pulse">pulse</option>
            <option value="rubberBand">rubberBand</option>
            <option value="shake">shake</option>
            <option value="swing">swing</option>
            <option value="tada">tada</option>
            <option value="wobble">wobble</option>
            <option value="jello">jello</option>
        </optgroup>
        <optgroup label="Bouncing Entrances">
            <option value="bounceIn">bounceIn</option>
            <option value="bounceInDown">bounceInDown</option>
            <option value="bounceInLeft">bounceInLeft</option>
            <option value="bounceInRight">bounceInRight</option>
            <option value="bounceInUp">bounceInUp</option>
        </optgroup>
        <optgroup label="Bouncing Exits">
            <option value="bounceOut">bounceOut</option>
            <option value="bounceOutDown">bounceOutDown</option>
            <option value="bounceOutLeft">bounceOutLeft</option>
            <option value="bounceOutRight">bounceOutRight</option>
            <option value="bounceOutUp">bounceOutUp</option>
        </optgroup>
        <optgroup label="Fading Entrances">
            <option value="fadeIn">fadeIn</option>
            <option value="fadeInDown">fadeInDown</option>
            <option value="fadeInDownBig">fadeInDownBig</option>
            <option value="fadeInLeft">fadeInLeft</option>
            <option value="fadeInLeftBig">fadeInLeftBig</option>
            <option value="fadeInRight">fadeInRight</option>
            <option value="fadeInRightBig">fadeInRightBig</option>
            <option value="fadeInUp">fadeInUp</option>
            <option value="fadeInUpBig">fadeInUpBig</option>
        </optgroup>
        <optgroup label="Fading Exits">
            <option value="fadeOut">fadeOut</option>
            <option value="fadeOutDown">fadeOutDown</option>
            <option value="fadeOutDownBig">fadeOutDownBig</option>
            <option value="fadeOutLeft">fadeOutLeft</option>
            <option value="fadeOutLeftBig">fadeOutLeftBig</option>
            <option value="fadeOutRight">fadeOutRight</option>
            <option value="fadeOutRightBig">fadeOutRightBig</option>
            <option value="fadeOutUp">fadeOutUp</option>
            <option value="fadeOutUpBig">fadeOutUpBig</option>
        </optgroup>
        <optgroup label="Flippers">
            <option value="flip">flip</option>
            <option value="flipInX">flipInX</option>
            <option value="flipInY">flipInY</option>
            <option value="flipOutX">flipOutX</option>
            <option value="flipOutY">flipOutY</option>
        </optgroup>
        <optgroup label="Lightspeed">
            <option value="lightSpeedIn">lightSpeedIn</option>
            <option value="lightSpeedOut">lightSpeedOut</option>
        </optgroup>
        <optgroup label="Rotating Entrances">
            <option value="rotateIn">rotateIn</option>
            <option value="rotateInDownLeft">rotateInDownLeft</option>
            <option value="rotateInDownRight">rotateInDownRight</option>
            <option value="rotateInUpLeft">rotateInUpLeft</option>
            <option value="rotateInUpRight">rotateInUpRight</option>
        </optgroup>
        <optgroup label="Rotating Exits">
            <option value="rotateOut">rotateOut</option>
            <option value="rotateOutDownLeft">rotateOutDownLeft</option>
            <option value="rotateOutDownRight">rotateOutDownRight</option>
            <option value="rotateOutUpLeft">rotateOutUpLeft</option>
            <option value="rotateOutUpRight">rotateOutUpRight</option>
        </optgroup>
        <optgroup label="Sliding Entrances">
            <option value="slideInUp">slideInUp</option>
            <option value="slideInDown">slideInDown</option>
            <option value="slideInLeft">slideInLeft</option>
            <option value="slideInRight">slideInRight</option>
        </optgroup>
        <optgroup label="Sliding Exits">
            <option value="slideOutUp">slideOutUp</option>
            <option value="slideOutDown">slideOutDown</option>
            <option value="slideOutLeft">slideOutLeft</option>
            <option value="slideOutRight">slideOutRight</option>
        </optgroup>
        <optgroup label="Zoom Entrances">
            <option value="zoomIn">zoomIn</option>
            <option value="zoomInDown">zoomInDown</option>
            <option value="zoomInLeft">zoomInLeft</option>
            <option value="zoomInRight">zoomInRight</option>
            <option value="zoomInUp">zoomInUp</option>
        </optgroup>
        <optgroup label="Zoom Exits">
            <option value="zoomOut">zoomOut</option>
            <option value="zoomOutDown">zoomOutDown</option>
            <option value="zoomOutLeft">zoomOutLeft</option>
            <option value="zoomOutRight">zoomOutRight</option>
            <option value="zoomOutUp">zoomOutUp</option>
        </optgroup>
        <optgroup label="Specials">
            <option value="hinge">hinge</option>
            <option value="jackInTheBox">jackInTheBox</option>
            <option value="rollIn">rollIn</option>
            <option value="rollOut">rollOut</option>
        </optgroup>
    </select>
    <p>1234 55 7 78</p>
    <script type="text/javascript">
    $(function() {

        sidePlay({
            btnImgUrl: 'btn.png',
            mp3url: 'SeeYouAgain.mp3',
            btnWidth: '50px',
            btnHeight: '50px',
            posLOrR: 'right', //left||right
            disLOrR: '-20px',
            posTOrB: 'bottom', //top||bottom
            disTOrB: '50vh',
            boxInWay: 'flipInY',
            dragWay:'y'
        })
    })


    function sidePlay(option) {
        //默认配置对象
        var config = {
            btnImgUrl: 'btn.png', //按钮背景
            boxImgUrl: 'btn.png', //弹窗背景
            mp3url: 'SeeYouAgain.mp3', //弹窗里的mp3
            btnWidth: '100px', //按钮宽度
            btnHeight: '100px', //按钮高度
            posLOrR: 'left', //按钮在窗口左右定位 left||right
            disLOrR: '0px', //左右定位的距离
            posTOrB: 'top', //按钮在窗口上下定位 top||bottom
            disTOrB: '0px', //上下定位的距离
            boxWidth: '50%', // 弹窗的宽度
            boxHeight: '200px', //弹窗的高度
            boxInWay: 'fadeIn', //弹窗的入场动画  //oppoWay 里的key
            boxLong: '0.75s', //弹窗动画时间
            dragWay:'none' //X,Y,none,all
        }


        var oppoWay = { //key 为弹窗进场动画，value为弹窗出场动画
            fadeIn: 'fadeOut',
            fadeInDown: 'fadeOutUp',
            fadeInDownBig: 'fadeOutUpBig',
            fadeInUp: 'fadeOutDown',
            bounceIn: 'bounceOut',
            bounceInDown: 'bounceOutUp',
            bounceInLeft: 'bounceOutRight',
            flipInX: 'flipOutX',
            flipInY: 'flipOutY',
            rollIn: 'rollOut',
            rotateIn: 'rotateOut',
            zoomInDown: 'zoomOutUp',
            lightSpeedIn: 'lightSpeedOut',
            flipInY: 'flipOutY'
        }

        var animationEnd = 'webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';

        $.fn.extend({
            animateCss: function(animationName) {
                var animationEnd = 'webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
                this.addClass('animated ' + animationName).one(animationEnd, function() {
                    $(this).removeClass('animated ' + animationName);
                });
                return this;
            }
        });

        config = extend(config, option);
        config.popWay = Number(config.popWay);

        //插入 animate.css
        $('head').append('<link href="http://cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">');

        // 创建 页面按钮
        var $btn = $('<div></div>');
        // 创建 弹窗
        var $box = $('<div></div>');

        var btnStyle = {
            'display': 'block',
            'position': 'fixed',
            'width': config.btnWidth,
            'height': config.btnHeight,
            'background': 'url(' + config.btnImgUrl + ') no-repeat center',
            'background-size': 'contain'

        }
        btnStyle[config.posLOrR] = config.disLOrR;
        btnStyle[config.posTOrB] = config.disTOrB;

        var boxStyle = {
            'display': 'none',
            'position': 'fixed',
            'width': config.boxWidth,
            'height': config.boxHeight,
            'background': 'url(' + config.boxImgUrl + ') no-repeat center',
            'background-size': 'contain',
            'top': '50%',
            'left': '50%',
            'margin-left': '-' + halfChange(config.boxWidth),
            'margin-top': '-' + halfChange(config.boxHeight),
            'animation-duration': config.boxLong
        }

        $btn.css(btnStyle);
        $box.css(boxStyle);

        $box.html('<div id="closeBoxx" style=" position:absolute;right:0px;top:0px;width20px;height20px;text-align:center;line-height:20px;">×</div><audio loop="loop" src=' + config.mp3url + ' preload="preload"></audio>')

        var audio = $box.find('audio').get(0);
        $('body').append($btn);
        $('body').append($box);


        // 按钮点击事件
        $btn.on('click', btnClick);

        function btnClick() {

            unbindClick();

            $box.show().animateCss(config.boxInWay);

            $btn.animateCss('fadeOut');
            $btn.one(animationEnd, function() {
                audio.play();
                $btn.hide();
                bindClick();
            })

        }

        var $closeBtn = $('#closeBoxx'); //关闭按钮

        $closeBtn.on('click', closeClick);

        function closeClick() {
            unbindClick();
            $btn.show().animateCss('fadeIn');

            $box.animateCss(oppoWay[config.boxInWay]);

            $box.one(animationEnd, function() {
                audio.pause();
                audio.currentTime = 0;
                $box.hide();
                bindClick();
            })

        }

        var touchLeft = touchTop = touchRight = touchBottom = 0;
        $btn.on('touchstart', function(evt) {
            var e = event || evt;
            // e.preventDefault();//阻止其他事件
            if (e.targetTouches.length == 1) {
                var touch = e.targetTouches[0]; // 把元素放在手指所在的位置
                touchLeft = touch.clientX - $btn.position().left;
                touchTop = touch.clientY - $btn.position().top;
                touchRight = $btn.width() - touchLeft;
                touchBottom = $btn.height() - touchTop;

            }
        }).on('touchmove', function(evt) {
            var e = event || evt;
            e.preventDefault(); //阻止其他事件
            if (e.targetTouches.length == 1) {
                var touch = e.targetTouches[0]; // 把元素放在手指所在的位置
                var left = touch.clientX - touchLeft;
                var top = touch.clientY - touchTop;
                var right = document.documentElement.clientWidth - touch.clientX - touchRight;
                var bottom = document.documentElement.clientHeight - touch.clientY - touchBottom;
                var obj = {};
                switch(config.dragWay.toLowerCase()){
                    case 'x':
                        obj[config.posLOrR] = config.posLOrR == 'left' ? left : right + 'px';
                    break;
                    case 'y':
                        obj[config.posTOrB] = config.posTOrB == 'top' ? top : bottom + 'px';
                    break;
                    case 'all':
                        obj[config.posLOrR] = config.posLOrR == 'left' ? left : right + 'px';
                        obj[config.posTOrB] = config.posTOrB == 'top' ? top : bottom + 'px';
                    break;
                    case 'none':
                    break;
                }
                
                
                $btn.css(obj);
            }
        }).on('touchend', function(evt) {
            var e = event || evt;
            //  e.preventDefault();//阻止其他事件
        })




        //解绑点击
        function unbindClick() {
            $btn.unbind('click');
            $closeBtn.unbind('click');
        }
        //绑定点击
        function bindClick() {
            $btn.on('click', btnClick);
            $closeBtn.on('click', closeClick);
        }

        function halfChange(s) {
            return parseInt(s) / 2 + s.split(parseInt(s)).pop();
        }

        // 合并对象
        function extend(target, source) {
            for (var obj in source) {
                target[obj] = source[obj];
            }
            return target;
        }

    }
    </script>
</body>

</html>